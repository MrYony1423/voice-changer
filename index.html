<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>×©×™× ×•×™ ×§×•×œ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      text-align: center;
      padding: 30px;
    }
    button, select {
      margin: 10px;
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button {
      background-color: #ff4081;
      color: white;
    }
    audio {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>ğŸ™ï¸ ×©×™× ×•×™ ×§×•×œ</h1>

  <button id="recordBtn">ğŸ¤ ×”×ª×—×œ ×”×§×œ×˜×”</button>
  <button id="stopBtn" disabled>â¹ï¸ ×¢×¦×•×¨ ×”×§×œ×˜×”</button>

  <br>
  <label for="voiceEffect">×‘×—×¨ ×§×•×œ:</label>
  <select id="voiceEffect">
    <option value="normal">×¨×’×™×œ</option>
    <option value="high">×’×‘×•×” ×•××¦×—×™×§</option>
    <option value="low">×¢××•×§ ×•××¤×—×™×“</option>
  </select>

  <br>
  <audio id="audioPlayer" controls></audio>

  <script>
    let mediaRecorder;
    let audioChunks = [];
    let audioBlob;

    const recordBtn = document.getElementById("recordBtn");
    const stopBtn = document.getElementById("stopBtn");
    const audioPlayer = document.getElementById("audioPlayer");
    const voiceEffect = document.getElementById("voiceEffect");

    recordBtn.onclick = async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          audioChunks.push(event.data);
        }
      };

      mediaRecorder.onstop = () => {
        audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        const url = URL.createObjectURL(audioBlob);
        applyEffectAndPlay(url);
      };

      mediaRecorder.start();
      recordBtn.disabled = true;
      stopBtn.disabled = false;
    };

    stopBtn.onclick = () => {
      mediaRecorder.stop();
      recordBtn.disabled = false;
      stopBtn.disabled = true;
    };

    function applyEffectAndPlay(url) {
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioCtx.createBufferSource();
      const request = new XMLHttpRequest();

      request.open('GET', url, true);
      request.responseType = 'arraybuffer';

      request.onload = function () {
        const audioData = request.response;

        audioCtx.decodeAudioData(audioData, function(buffer) {
          source.buffer = buffer;

          // ×©×™× ×•×™ ××”×™×¨×•×ª ×œ×”×©×¤×¢×” ×¢×œ ×”×§×•×œ
          const effect = voiceEffect.value;
          if (effect === "high") {
            source.playbackRate.value = 1.8;
          } else if (effect === "low") {
            source.playbackRate.value = 0.6;
          } else {
            source.playbackRate.value = 1.0;
          }

          source.connect(audioCtx.destination);
          source.start(0);
        });
      };
      request.send();

      audioPlayer.src = url;
    }
  </script>
</body>
</html>
